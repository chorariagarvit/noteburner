name = "noteburner-api"
main = "src/index.js"
compatibility_date = "2025-11-17"
compatibility_flags = [
  "nodejs_compat_v2"
]

# Enable logs
observability = { enabled = true }

# Routes for production deployment
routes = [
  { pattern = "noteburner.work/api/*", zone_name = "noteburner.work" },
  { pattern = "api.noteburner.work/*", zone_name = "noteburner.work" }
]

# D1 Database binding
[[ d1_databases ]]
binding = "DB"
database_name = "noteburner-db"
database_id = "aa64ae0a-1bbe-4916-b083-b8e027b53148" # Add your database ID after running: wrangler d1 create noteburner-db

# R2 Storage binding for media files
[[ r2_buckets ]]
binding = "MEDIA_BUCKET"
bucket_name = "noteburner-media"

# Email Worker binding (Cloudflare Email Routing)
# Run: wrangler types --env-interface CloudflareBindings
[[ send_email ]]
name = "EMAIL_SENDER"

# Environment variables
[vars]
FRONTEND_URL = "https://noteburner.work"
EMAIL_FROM = "hello@noteburner.work"  # Sender email address (use hello@/team@/support@ for better deliverability)
DEFAULT_EXPIRY_HOURS = "24"  # Default expiration time in hours
MAX_MESSAGE_SIZE = "10485760"  # 10MB
MAX_FILE_SIZE = "2147483648"   # 2GB (uses chunked uploads for files >100MB)
RATE_LIMIT_REQUESTS = "10"
RATE_LIMIT_WINDOW = "60"       # seconds

# Scheduled cleanup job (runs every hour)
[triggers]
crons = ["0 * * * *"]

# CORS settings
[env.production]
name = "noteburner-api"
FRONTEND_URL = "https://noteburner.work"  # Update with your actual Pages URL

[env.development]
name = "noteburner-api-dev"
